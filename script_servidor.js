const express=require("express"),cors=require("cors"),{Pool}=require("pg"),app=express();app.use(express.json()),app.use(cors());const helmet=require("helmet");app.use(express.static('public'));app.use(helmet.noSniff()),app.use(helmet.xssFilter()),app.use(helmet.crossOriginEmbedderPolicy()),app.use(helmet.ieNoOpen()),app.use(helmet.hsts({maxAge:31536e3,includeSubDomains:!0,preload:!0})),app.use(helmet.contentSecurityPolicy({directives:{defaultSrc:["'self'"],scriptSrc:["'self'"],styleSrc:["'self'"],imgSrc:["*"],connectSrc:["*"],fontSrc:["'self'"],objectSrc:["'none'"],upgradeInsecureRequests:[]}})),app.use(helmet.frameguard({action:"deny"}));const pool=new Pool({host:process.env.PG_HOST||"ep-shy-haze-a5fn30na-pooler.us-east-2.aws.neon.tech",user:process.env.PG_USER||"neondb_owner",password:process.env.PG_PASSWORD||"8XJOeoMIWr0U",database:process.env.PG_DB||"neondb",port:5432,ssl:{rejectUnauthorized:!1}});pool.connect().then(()=>{console.log("ConexÃ£o ao banco de dados estabelecida com sucesso!")}).catch(e=>{console.error("Erro ao conectar ao banco de dados:",e)});app.get("/cantina_dados",async(e,o)=>{try{const e=await pool.query("SELECT * FROM cantina_mira");if(0===e.rows.length)return console.log("Nenhum dado encontrado na tabela cantina_mira."),void o.json([]);console.log("Dados pegos:",e.rows);var s=JSON.stringify(e.rows);o.json(s)}catch(e){console.error("Erro ao executar a consulta:",e),o.status(500).json({error:"Erro ao obter dados",details:e.message})}});app.get("/novidades",async(e,o)=>{try{const e=await pool.query("SELECT * FROM novidades ORDER BY id DESC LIMIT 1");if(0===e.rows.length)return console.log("Nenhum dado encontrado na tabela novidades."),void o.json([]);console.log("Dados pegos:",e.rows);var s=JSON.stringify(e.rows);o.json(s)}catch(e){console.error("Erro ao executar a consulta:",e),o.status(500).json({error:"Erro ao obter dados",details:e.message})}});app.get("/empresa",async(e,o)=>{try{const e=await pool.query("SELECT * FROM empresa");if(0===e.rows.length)return console.log("Nenhum dado encontrado na tabela empresa."),void o.json([]);console.log("Dados pegos:",e.rows);var s=JSON.stringify(e.rows);o.json(s)}catch(e){console.error("Erro ao executar a consulta:",e),o.status(500).json({error:"Erro ao obter dados",details:e.message})}});const porta=process.env.PORT||9001;app.listen(porta,e=>{e?console.error("Tivemos um pequeno erro: "+e):console.log("Servidor conectado na porta "+porta)});
